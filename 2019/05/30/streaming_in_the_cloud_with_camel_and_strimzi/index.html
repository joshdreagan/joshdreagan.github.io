<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Streaming in the Cloud With Camel and Strimzi - Reagan&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Reagan&#039;s Blog"><meta name="msapplication-TileImage" content="/img/favicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Reagan&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="So I was at one of my favorite customers several months back, and was demo’ing our new AMQ Streams product (aka Strimzi). They asked for some example Apache Camel apps to show them how to securely con"><meta property="og:type" content="blog"><meta property="og:title" content="Streaming in the Cloud With Camel and Strimzi"><meta property="og:url" content="https://blog.joshdreagan.com/2019/05/30/streaming_in_the_cloud_with_camel_and_strimzi/"><meta property="og:site_name" content="Reagan&#039;s Blog"><meta property="og:description" content="So I was at one of my favorite customers several months back, and was demo’ing our new AMQ Streams product (aka Strimzi). They asked for some example Apache Camel apps to show them how to securely con"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://blog.joshdreagan.com/2019/05/30/streaming_in_the_cloud_with_camel_and_strimzi/post-bg.jpg"><meta property="article:published_time" content="2019-05-30T23:23:43.000Z"><meta property="article:modified_time" content="2021-01-14T22:53:29.023Z"><meta property="article:author" content="Josh Reagan"><meta property="article:tag" content="fuse"><meta property="article:tag" content="camel"><meta property="article:tag" content="spring-boot"><meta property="article:tag" content="kafka"><meta property="article:tag" content="openshift"><meta property="article:tag" content="strimzi"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/2019/05/30/streaming_in_the_cloud_with_camel_and_strimzi/post-bg.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.joshdreagan.com/2019/05/30/streaming_in_the_cloud_with_camel_and_strimzi/"},"headline":"Reagan's Blog","image":["https://blog.joshdreagan.com/2019/05/30/streaming_in_the_cloud_with_camel_and_strimzi/post-bg.jpg"],"datePublished":"2019-05-30T23:23:43.000Z","dateModified":"2021-01-14T22:53:29.023Z","author":{"@type":"Person","name":"Josh Reagan"},"description":"So I was at one of my favorite customers several months back, and was demo’ing our new AMQ Streams product (aka Strimzi). They asked for some example Apache Camel apps to show them how to securely con"}</script><link rel="canonical" href="https://blog.joshdreagan.com/2019/05/30/streaming_in_the_cloud_with_camel_and_strimzi/"><link rel="alternate" href="/atom.xml" title="Reagan&#039;s Blog" type="application/atom+xml"><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-81075900-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-81075900-1');</script><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="Reagan&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/tags">Tags</a></div><div class="navbar-end"><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-image"><span class="image"><img class="fill" src="/2019/05/30/streaming_in_the_cloud_with_camel_and_strimzi/post-bg.jpg" alt="Streaming in the Cloud With Camel and Strimzi"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2019-05-30T23:23:43.000Z" title="5/30/2019, 5:23:43 PM">2019-05-30</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-01-14T22:53:29.023Z" title="1/14/2021, 3:53:29 PM">2021-01-14</time></span></div></div><h1 class="title is-3 is-size-4-mobile">Streaming in the Cloud With Camel and Strimzi</h1><div class="content"><p>So I was at one of my favorite customers several months back, and was demo’ing our new <a target="_blank" rel="noopener" href="https://access.redhat.com/products/red-hat-amq#streams">AMQ Streams</a> product (aka <a target="_blank" rel="noopener" href="https://strimzi.io/">Strimzi</a>). They asked for some example <a target="_blank" rel="noopener" href="https://camel.apache.org/">Apache Camel</a> apps to show them how to securely connect to their newly installed Kafka on OpenShift. Not an unreasonable request… But try as I might, I could not find any existing examples. Sure, I found examples of Camel talking to Kafka, but not doing so securely. I found examples of Camel talking to Kafka <em>with</em> authz, but not running in OpenShift. I even found examples of plain Java clients running in OpenShift <strong>and</strong> doing authz, but not using Camel. So I offered to create a set of examples for them “as soon as I got some free time”. Six months later… here we go! ;)<a id="more"></a></p>
<p>For the purpose of this blog, let’s go ahead and assume that you’ve already installed OpenShift. Let’s also assume that you’ve installed Strimzi onto your OpenShift environment and have a Kafka cluster running. There’s no need to cover either of those topics since they’re both thoroughly outlined in the existing documentation. Instead, let’s focus a bit on authentication and authorization. And more specifically, how those work in Strimzi. </p>
<p>At present, there are two mechanisms for authentication (TLS or SCRAM-SHA-512), and one for authorization (simple). So we’ll need to both enable “simple” authorization on the broker, and choose/enable one of the authorization mechanisms on the listener. It’s actually really easy! You can just follow the docs <a target="_blank" rel="noopener" href="https://strimzi.io/docs/master/#assembly-kafka-authentication-and-authorization-deployment-configuration-kafka">here</a>. So now my brokers expect me to authenticate? Great… How do I do that? Well, you’ll need to create and apply a “KafkaUser” definition. In said “KafkaUser” definition, you’ll specify both the authentication type (which should match the authentication type that you’ve chosen for your listener), and the authorization roles. The authorization roles are what gives permissions to a specific resource. So, for instance, whether or not a user has access to read or write to a topic. They are detailed in the docs <a target="_blank" rel="noopener" href="https://strimzi.io/docs/master/#simple_authorization_2">here</a>. Once you’ve applied your “KafkaUser” definition to OpenShift, the “<a target="_blank" rel="noopener" href="https://strimzi.io/docs/master/#assembly-user-operator-str">User Operator</a>“ will detect it and generate some resources for you automagically. Neat! But what does it generate? Well that depends on the authentication type you’ve chosen. Let’s start with SCRAM since it’s the easiest. </p>
<p><strong>SCRAM-SHA-512</strong></p>
<p>When you create a “KafkaUser” with a “scram-sha-512” authentication type, the “User Operator” will generate an OpenShift “Secret” with the same name. So, if I’ve defined a user named “bob”, I will see a secret named “bob” that has a key called “password”. Those are the credentials that I’ll use to connect. Seems straighforward… But how do I get that into my app? The easiest way is to inject the password into an environment variable in your container. You can do this in your <code>deployment.yml</code> file for your app. Here’s an example:</p>
<figure class="highlight yaml"><figcaption><span>deployment.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#...</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KAFKA_USER_PASSWORD</span></span><br><span class="line">  <span class="attr">valueFrom:</span></span><br><span class="line">    <span class="attr">secretKeyRef:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">bob</span></span><br><span class="line">      <span class="attr">key:</span> <span class="string">password</span></span><br><span class="line"><span class="comment">#...</span></span><br></pre></td></tr></table></figure>
<p>If I include the above snippet into my <code>deployment.yml</code>, I will have a <code>KAFKA_USER_PASSWORD</code> environment variable (containing my generated password) available to me inside of my container. So I can just reference it in my <code>application.yml</code> file like below.</p>
<figure class="highlight yaml"><figcaption><span>application.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#...</span></span><br><span class="line"><span class="attr">camel:</span></span><br><span class="line">  <span class="attr">component:</span></span><br><span class="line">    <span class="attr">kafka.configuration:</span></span><br><span class="line">      <span class="attr">security-protocol:</span> <span class="string">SASL_PLAINTEXT</span></span><br><span class="line">      <span class="attr">sasl-mechanism:</span> <span class="string">SCRAM-SHA-512</span></span><br><span class="line">      <span class="attr">sasl-jaas-config:</span> <span class="string">org.apache.kafka.common.security.scram.ScramLoginModule</span> <span class="string">required</span> <span class="string">username=&quot;bob&quot;</span> <span class="string">password=&quot;$&#123;KAFKA_USER_PASSWORD&#125;&quot;;</span></span><br><span class="line"><span class="comment">#...</span></span><br></pre></td></tr></table></figure>
<p>Now, when my Camel app connects to Kafka, it will connect as my specified user, using the auto-generated password. And, if desired, I can have OpenShift trigger a reload of my app if the password is updated/regenerated. Cool beans! On to a slightly more complex case…</p>
<p><strong>TLS</strong></p>
<p>When using “tls” as my authentication type, I (as a client) will need both the broker’s public key, as well as my user’s public &amp; private keys. Such is the nature of mutual auth… Similarly though, those will be generated for me by the various operators. But it’s a little more complicated than the SCRAM case. How so? Well, just like before, I can inject the secret values into environment variables as shown below. So no issues yet.</p>
<figure class="highlight yaml"><figcaption><span>deployment.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#...</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KAFKA_CLUSTER_CRT</span></span><br><span class="line">  <span class="attr">valueFrom:</span></span><br><span class="line">    <span class="attr">secretKeyRef:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">my-cluster-cluster-ca-cert</span></span><br><span class="line">      <span class="attr">key:</span> <span class="string">ca.crt</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KAFKA_USER_CRT</span></span><br><span class="line">  <span class="attr">valueFrom:</span></span><br><span class="line">    <span class="attr">secretKeyRef:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">alice</span></span><br><span class="line">      <span class="attr">key:</span> <span class="string">user.crt</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">KAFKA_USER_KEY</span></span><br><span class="line">  <span class="attr">valueFrom:</span></span><br><span class="line">    <span class="attr">secretKeyRef:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">alice</span></span><br><span class="line">      <span class="attr">key:</span> <span class="string">user.key</span></span><br><span class="line"><span class="comment">#...</span></span><br></pre></td></tr></table></figure>
<p>But I can’t just use those key/cert values directly. I actually need to create a keystore &amp; truststore, and then import those keys into their appropriate stores. Well, how do I go about that? One solution would be to use a custom container image and start script as per <a target="_blank" rel="noopener" href="https://github.com/strimzi/client-examples">Jakub’s example</a>. While this solution is very clever (as is Jakub :)), I wondered if there was a way to do it all within my app code. A quick Google search and, lo and behold, I find <a target="_blank" rel="noopener" href="https://github.com/heroku/env-keystore">env-keystore</a>! This handy little library will let me easily create Java keystores using arbitrary keys/certs from string values. So now I can actually use those injected environment variable values. What’s more, it can write the stores out to a file once I’ve created them. And since it uses <a target="_blank" rel="noopener" href="https://www.bouncycastle.org/">Bouncy Castle</a>, it can handle both Java formatted keys/certs as well as OpenSSL formatted ones (which is what Strimzi will generate for you). Good stuff! So if I include the below dependency…</p>
<figure class="highlight xml"><figcaption><span>pom.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.heroku.sdk<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>env-keystore<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>x.x.x<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>And add a little bit of initialization code…</p>
<figure class="highlight java"><figcaption><span>KafkaComponentCustomizer.java</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.apache.camel.examples;</span><br><span class="line"></span><br><span class="line"><span class="comment">//import ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaComponentCustomizer</span> <span class="keyword">implements</span> <span class="title">ComponentCustomizer</span>&lt;<span class="title">KafkaComponent</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span> <span class="keyword">private</span> KafkaComponentConfiguration kafkaConfiguration;</span><br><span class="line">  <span class="meta">@Value(&quot;#&#123;systemEnvironment[&#x27;KAFKA_CLUSTER_CRT&#x27;]&#125;&quot;)</span> <span class="keyword">private</span> String kafkaClusterCrt;</span><br><span class="line">  <span class="meta">@Value(&quot;#&#123;systemEnvironment[&#x27;KAFKA_USER_KEY&#x27;]&#125;&quot;)</span> <span class="keyword">private</span> String kafkaUserKey;</span><br><span class="line">  <span class="meta">@Value(&quot;#&#123;systemEnvironment[&#x27;KAFKA_USER_CRT&#x27;]&#125;&quot;)</span> <span class="keyword">private</span> String kafkaUserCrt;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(KafkaComponent component)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        BasicKeyStore truststore = <span class="keyword">new</span> BasicKeyStore(kafkaClusterCrt, kafkaConfiguration.getConfiguration().getSslTruststorePassword());</span><br><span class="line">        truststore.store(Paths.get(kafkaConfiguration.getConfiguration().getSslTruststoreLocation()));</span><br><span class="line"></span><br><span class="line">        BasicKeyStore keystore = <span class="keyword">new</span> BasicKeyStore(kafkaUserKey, kafkaUserCrt, kafkaConfiguration.getConfiguration().getSslKeystorePassword());</span><br><span class="line">        keystore.store(Paths.get(kafkaConfiguration.getConfiguration().getSslKeystoreLocation()));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException | GeneralSecurityException e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>My app can now grab those generated keys/certs from the OpenShift secrets, inject them into env variables, use those values to generate the client keystore/trustore, then reference those stores when it makes its connection to the brokers. More difficult than SCRAM, but still not too bad. Although…</p>
<p><strong>Syncing the secrets</strong></p>
<p>When the various operators generate secrets for you, they will do so in the namespace where the resources live. That’s all fine and good if my apps are colocated alongside my Kafka cluster. But what if I want to put my cluster in one namespace (let’s say one called “strimzi”), and my client apps in another (let’s say it’s called “fuse”)? Unfortunately, OpenShift currently won’t allow me to access secrets between namespaces. So I’d have to copy the values from the generated secrets in my “strimzi” namespace into manually created secrets in my “fuse” namespace where my client apps live. That sounds super error prone. What do I do if those secrets update/regenerate? Certificates do expire right? I’ll have to make sure that when they update, I’ll go update all the copies. That’s a recipe for disaster! If only there was a way to syncronize those secrets between namespaces automatically. A little bit of searching and you’ll likely stumble across <a target="_blank" rel="noopener" href="https://github.com/appscode/kubed">AppsCode Kubed</a>. </p>
<p>Kubed is an operator that, once installed, will monitor and sync any secrets you specify (among other things). It will keep them updated if the source secret changes, and even remove the copies if the source secret is deleted. And it can do this across as many namespaces as you need. So no need to worry if you have multiple apps in multiple namespaces. Perfect right!? Well, one minor hitch…</p>
<p>The way Kubed works, you have to apply an OpenShift annotation to the secret that you want sync’d. It will then find and monitor any secrets with said annotation, and then sync them to namespaces that have the appropriate label. Unfortunately, if the Strimzi operators see that the secret has been changed in any way (like say, adding an annotation), they will squash those changes and get things back in sync with their configs. Which really <strong>is</strong> what they should do in that case… There’s currently a JIRA issue open for adding the ability to specify annotations on the generated secrets via the Strimzi configs. And once that enhancement is made, Kubed will definitely be the way to go. But what can we do in the meantime?</p>
<p>It’s not great, but one option is to use a “CronJob” that will simply execute some bash commands to sync the secrets. Clunky? Yes. Ideal? No. Works? Yes. Here’s an example one that I wrote to sync the broker’s public key. I installed it into the “fuse” namespace, and it sync’d my secret from the “strimzi” namespace, as needed, every second.</p>
<figure class="highlight yaml"><figcaption><span>secret-sync-cronjob.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CronJob</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">camel-kafka-authz-secret-sync</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">schedule:</span> <span class="string">&quot;* * * * *&quot;</span></span><br><span class="line">  <span class="attr">concurrencyPolicy:</span> <span class="string">Forbid</span></span><br><span class="line">  <span class="attr">jobTemplate:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="attr">spec:</span></span><br><span class="line">          <span class="attr">serviceAccountName:</span> <span class="string">camel-kafka-authz-sa</span></span><br><span class="line">          <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br><span class="line">          <span class="attr">containers:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cluster-ca-cert-sync</span></span><br><span class="line">            <span class="attr">image:</span> <span class="string">openshift/origin-cli</span></span><br><span class="line">            <span class="attr">command:</span> [<span class="string">&quot;bash&quot;</span>,  <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;export SRC=\&quot;$(oc extract -n strimzi secrets/my-cluster-cluster-ca-cert --keys=ca.crt --to=-)\&quot;; export DST=\&quot;$(oc extract -n fuse secrets/my-cluster-cluster-ca-cert --keys=ca.crt --to=-)\&quot;; if [ -n \&quot;$SRC\&quot; ] &amp;&amp; [ \&quot;$DST\&quot; != \&quot;$SRC\&quot; ]; then echo &#x27;Values differ. Syncing...&#x27;; oc create secret generic -n fuse --dry-run -o yaml my-cluster-cluster-ca-cert --from-literal=\&quot;ca.crt=$SRC\&quot; | oc apply -f -; fi;&quot;</span>]</span><br></pre></td></tr></table></figure>
<p>So once again, we’ve managed to solve all the worlds problems. Or maybe none of them… :) Either way, if you’re looking for more than just snippets, take a look at the full source code for this example: <a target="_blank" rel="noopener" href="https://github.com/joshdreagan/camel-kafka-authz">https://github.com/joshdreagan/camel-kafka-authz</a>.</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Streaming in the Cloud With Camel and Strimzi</p><p><a href="https://blog.joshdreagan.com/2019/05/30/streaming_in_the_cloud_with_camel_and_strimzi/">https://blog.joshdreagan.com/2019/05/30/streaming_in_the_cloud_with_camel_and_strimzi/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Josh Reagan</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2019-05-30</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2021-01-14</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/fuse/">fuse</a><a class="link-muted mr-2" rel="tag" href="/tags/camel/">camel</a><a class="link-muted mr-2" rel="tag" href="/tags/spring-boot/">spring-boot</a><a class="link-muted mr-2" rel="tag" href="/tags/kafka/">kafka</a><a class="link-muted mr-2" rel="tag" href="/tags/openshift/">openshift</a><a class="link-muted mr-2" rel="tag" href="/tags/strimzi/">strimzi</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2019/10/14/artemis_disaster_recovery/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Artemis Disaster Recovery</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2018/08/30/camel_aggregation_strategies/"><span class="level-item">Camel Aggregation Strategies</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="https://www.gravatar.com/avatar/29313b56e332976a2383b911a27c15b2?s=128" alt="Josh Reagan"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Josh Reagan</p><p class="is-size-6 is-block">Software Engineer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Colorado, USA</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">26</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">20</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/joshdreagan" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/joshdreagan"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com/joshdreagan"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/joshdreagan"><i class="fab fa-linkedin"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><figure class="media-left"><a class="image" href="/2025/06/19/bridging_apache_artemis_part_2/"><img src="/2025/06/19/bridging_apache_artemis_part_2/post-bg.jpg" alt="Bridging Apache Artemis - Part 2"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-06-19T21:17:51.000Z">2025-06-19</time></p><p class="title"><a href="/2025/06/19/bridging_apache_artemis_part_2/">Bridging Apache Artemis - Part 2</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2020/03/20/dropping_dups_with_camel/"><img src="/2020/03/20/dropping_dups_with_camel/post-bg.jpg" alt="Dropping Dups With Camel"></a></figure><div class="media-content"><p class="date"><time dateTime="2020-03-20T20:57:20.000Z">2020-03-20</time></p><p class="title"><a href="/2020/03/20/dropping_dups_with_camel/">Dropping Dups With Camel</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2019/10/14/artemis_disaster_recovery/"><img src="/2019/10/14/artemis_disaster_recovery/post-bg.jpg" alt="Artemis Disaster Recovery"></a></figure><div class="media-content"><p class="date"><time dateTime="2019-10-15T04:55:40.000Z">2019-10-14</time></p><p class="title"><a href="/2019/10/14/artemis_disaster_recovery/">Artemis Disaster Recovery</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2019/05/30/streaming_in_the_cloud_with_camel_and_strimzi/"><img src="/2019/05/30/streaming_in_the_cloud_with_camel_and_strimzi/post-bg.jpg" alt="Streaming in the Cloud With Camel and Strimzi"></a></figure><div class="media-content"><p class="date"><time dateTime="2019-05-30T23:23:43.000Z">2019-05-30</time></p><p class="title"><a href="/2019/05/30/streaming_in_the_cloud_with_camel_and_strimzi/">Streaming in the Cloud With Camel and Strimzi</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/2018/08/30/camel_aggregation_strategies/"><img src="/2018/08/30/camel_aggregation_strategies/post-bg.jpg" alt="Camel Aggregation Strategies"></a></figure><div class="media-content"><p class="date"><time dateTime="2018-08-31T04:43:34.000Z">2018-08-30</time></p><p class="title"><a href="/2018/08/30/camel_aggregation_strategies/">Camel Aggregation Strategies</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2025/06/"><span class="level-start"><span class="level-item">June 2025</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">October 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">May 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">August 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/03/"><span class="level-start"><span class="level-item">March 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">December 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/03/"><span class="level-start"><span class="level-item">March 2017</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/01/"><span class="level-start"><span class="level-item">January 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/11/"><span class="level-start"><span class="level-item">November 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/10/"><span class="level-start"><span class="level-item">October 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/08/"><span class="level-start"><span class="level-item">August 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/07/"><span class="level-start"><span class="level-item">July 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/05/"><span class="level-start"><span class="level-item">May 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/02/"><span class="level-start"><span class="level-item">February 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/12/"><span class="level-start"><span class="level-item">December 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/10/"><span class="level-start"><span class="level-item">October 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/08/"><span class="level-start"><span class="level-item">August 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/05/"><span class="level-start"><span class="level-item">May 2015</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/04/"><span class="level-start"><span class="level-item">April 2015</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/activemq/"><span class="tag">activemq</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/amq/"><span class="tag">amq</span><span class="tag">13</span></a></div><div class="control"><a class="tags has-addons" href="/tags/artemis/"><span class="tag">artemis</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bpms/"><span class="tag">bpms</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/camel/"><span class="tag">camel</span><span class="tag">21</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cxf/"><span class="tag">cxf</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/datagrid/"><span class="tag">datagrid</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/fabric8/"><span class="tag">fabric8</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/feedhenry/"><span class="tag">feedhenry</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/fuse/"><span class="tag">fuse</span><span class="tag">20</span></a></div><div class="control"><a class="tags has-addons" href="/tags/infinispan/"><span class="tag">infinispan</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jboss/"><span class="tag">jboss</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jbpm/"><span class="tag">jbpm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/kafka/"><span class="tag">kafka</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/karaf/"><span class="tag">karaf</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/narayana/"><span class="tag">narayana</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openshift/"><span class="tag">openshift</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spring-boot/"><span class="tag">spring-boot</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/strimzi/"><span class="tag">strimzi</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wildfly/"><span class="tag">wildfly</span><span class="tag">5</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="Reagan&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2025 Josh Reagan</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>